FROM node:18-alpine

# Run as non-root for safety
RUN addgroup -S botgroup && adduser -S botuser -G botgroup
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN chown -R botuser:botgroup /app
USER botuser
ENV NODE_ENV=production
EXPOSE 3000
CMD ["sh", "-c", "npm run start || node index.js || node bot.js"]
